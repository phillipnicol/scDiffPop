"0","mydeg <- function(sco.curr) {"
"0","    require(Matrix)"
"0","    require(dplyr)"
"0","    exp.curr1 = sco.curr@assays$RNA@counts[sco.curr@assays$RNA@var.features,]"
"0","    meta.dt1 = sco.curr@meta.data %>%"
"0","        as.data.table() %>%"
"0","        .[,.(binaryResponse=response, patient=patient)] "
"0","    "
"0","    meta.curr = list()"
"0","    exp.curr2 = list()"
"0","    for(patient in unique(meta.dt1$patient)){"
"0","        inx = which(meta.dt1$patient==patient)"
"0","        exp.curr2[[patient]] = rowSums(as.matrix(exp.curr1[,inx]),na.rm=T)"
"0","        meta.curr[[patient]] = meta.dt1[inx[1],]"
"0","    }"
"0","    meta.dt = do.call(rbind, meta.curr)"
"0","    exp.curr = t(do.call(rbind, exp.curr2))"
"0","    responders = meta.dt[binaryResponse==1]$patient"
"0","    nonresponders = meta.dt[binaryResponse==0]$patient"
"0","    print(responders)"
"0","    print(nonresponders)"
"0","    deseq.out = DESeq2DETest(data.use=exp.curr[,c(responders,nonresponders)], cells.1=responders, cells.2=nonresponders)"
"0","    deseq.dt = deseq.out %>%"
"0","    as.data.frame %>% "
"0","        mutate(gene=rownames(.)) %>%"
"0","        as.data.table() %>%"
"0","        .[order(pvalue)] %>%"
"0","        .[,padj:=p.adjust(pvalue, method=""fdr"")]"
"0","    deseq.dt"
"0","}"
